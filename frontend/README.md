# 知识图谱构建器 - API 测试平台使用说明

## 📋 概述

这是一个用于测试知识图谱构建器 API 的前端测试平台，提供直观的用户界面来测试所有后端接口。

## 🚀 快速开始

### 1. 启动后端服务

```bash
cd backend
python app.py
```

后端将在 `http://localhost:7860` 运行

### 2. 打开测试页面

在浏览器中打开 `frontend/test.html` 文件，或者直接双击该文件。

## 🎯 功能模块

### 1. Neo4j 数据库连接

**功能：** 测试与 Neo4j 数据库的连接

**必填字段：**
- 数据库 URI：例如 `bolt://127.0.0.1:7687`
- 用户名：例如 `neo4j`
- 密码：你的数据库密码

**可选字段：**
- 数据库名称：默认 `neo4j`
- 邮箱：用于日志记录

**操作：** 点击 "🔍 测试连接" 按钮

**成功标志：** 状态徽章从 "未连接" 变为 "已连接"

---

### 2. 文件上传 (分块上传)

**功能：** 上传文档文件到系统，支持大文件分块上传

**步骤：**

1. **选择模型**
   - DeepSeek Chat
   - Qwen 3 Max

2. **选择文件**
   - 点击上传区域或拖拽文件
   - 支持格式：PDF, TXT, DOCX, DOC
   - 显示文件信息（文件名、大小、类型）

3. **上传文件**
   - 系统自动将文件分成 5MB 的块
   - 显示实时上传进度
   - 上传成功后自动填充文件名到提取表单

**注意事项：**
- 上传前请确保已配置数据库连接
- 大文件会被自动分块上传，避免超时

---

### 3. 知识图谱提取

**核心功能：** 从不同数据源提取知识图谱并存储到 Neo4j

#### 数据源类型

##### A. 本地文件

**适用场景：** 处理已上传到服务器的文件

**必填字段：**
- 文件名：从上传成功后自动填充，或手动输入

##### B. 网页 URL

**适用场景：** 从网页内容提取知识图谱

**必填字段：**
- URL 地址：例如 `https://example.com/article`

##### C. Bilibili 视频

**适用场景：** 从 Bilibili 视频字幕提取知识图谱

**必填字段：**
- Bilibili URL：例如 `https://www.bilibili.com/video/BV...`

##### D. 维基百科

**适用场景：** 从维基百科文章提取知识图谱

**必填字段：**
- 搜索关键词：例如 `Artificial Intelligence`

#### 高级参数

**分块参数：**
- Token 块大小：默认 10000，控制每个文本块的 token 数量
- 块重叠大小：默认 200，相邻块之间的重叠 token 数
- 组合块数量：默认 5，将多个小块组合成大块进行实体识别

**过滤参数：**
- 允许的节点类型：逗号分隔，例如 `Person,Organization,Location`
- 允许的关系类型：逗号分隔，例如 `WORKS_AT,LOCATED_IN`

**其他参数：**
- 语言：中文 / English
- 额外指令：自定义 LLM 提取指令
- 重试条件：
  - `start_from_beginning` - 从头开始处理
  - `delete_entities_and_start_from_beginning` - 删除现有实体并重新开始
  - `start_from_last_processed_position` - 从上次位置继续

**操作：** 点击 "⚗️ 提取知识图谱" 按钮

---

## 📊 响应历史

- 自动记录所有 API 调用历史
- 显示时间戳、操作类型、成功/失败状态
- 保留最近 10 条记录
- 支持清空历史

---

## 🔧 典型使用流程

### 流程 1: 处理本地文件

1. 配置 Neo4j 数据库连接 → 测试连接
2. 选择模型 → 选择文件 → 上传文件
3. 等待上传完成，文件名自动填充
4. 配置提取参数（可选）
5. 点击 "提取知识图谱"

### 流程 2: 处理网页内容

1. 配置 Neo4j 数据库连接 → 测试连接
2. 选择 "网页 URL" 数据源
3. 输入 URL 地址
4. 配置提取参数（可选）
5. 点击 "提取知识图谱"

### 流程 3: 处理 Bilibili 视频

1. 配置 Neo4j 数据库连接 → 测试连接
2. 选择 "Bilibili 视频" 数据源
3. 输入 Bilibili 视频 URL
4. 配置提取参数（可选）
5. 点击 "提取知识图谱"

---

## 📝 API 响应格式

### 成功响应示例

```json
{
  "status": "Success",
  "message": "Source Node Created Successfully",
  "data": {
    "fileName": "example.pdf",
    "fileSize": 1234567,
    "chunkNodeCount": 150,
    "entityNodeCount": 340,
    "nodeCount": 490,
    "relationshipCount": 680
  }
}
```

### 失败响应示例

```json
{
  "status": "Failed",
  "error": "Error message details",
  "message": "Unable to extract knowledge graph"
}
```

---

## ⚠️ 故障排除

### 问题 1: 数据库连接失败

**解决方案：**
- 检查 Neo4j 服务是否运行
- 验证 URI、用户名、密码是否正确
- 确认数据库端口（默认 7687）未被防火墙阻止

### 问题 2: 文件上传失败

**解决方案：**
- 确保后端服务正在运行
- 检查文件格式是否支持
- 验证文件大小，尝试较小文件

### 问题 3: 知识图谱提取超时

**解决方案：**
- 检查网络连接
- 减小 Token 块大小
- 增加 LLM API 超时时间
- 查看后端日志获取详细错误信息

### 问题 4: CORS 错误

**解决方案：**
- 确保后端 CORS 中间件配置正确
- 使用 HTTP 服务器而不是直接打开 HTML 文件
- 示例：`python -m http.server 8000` 在 frontend 目录

---

## 🔐 安全建议

- ⚠️ **不要在生产环境中暴露数据库密码**
- ⚠️ **仅在测试环境使用此页面**
- ⚠️ **定期更换 API 密钥和数据库密码**
- ⚠️ **不要在公共网络中测试**

---

## 📚 技术栈

- **前端：** 纯 HTML + CSS + JavaScript（无需构建）
- **后端：** FastAPI + Python
- **数据库：** Neo4j
- **LLM：** DeepSeek / Qwen

---

## 🎨 界面特性

- 响应式设计，支持移动端
- 实时进度显示
- 拖拽上传支持
- 自动文件分块
- 语法高亮的 JSON 响应显示
- 响应历史记录

---

## 📞 支持

如有问题，请查看：
1. 后端日志输出
2. 浏览器开发者工具（F12）Console
3. Network 标签查看请求详情

---

## 🔄 更新日志

### v1.0.0 (2025-01-26)
- 初始版本
- 支持所有核心 API 测试
- 文件分块上传
- 多数据源支持
- 响应历史记录
